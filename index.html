<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Imaba Studio â€” AI</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-1:#f6f7fb;
    --bg-2:#e9eefb;
    --card:#ffffffdd;
    --muted:#6b7280;
    --accent:#6c8cff; /* pastel blue */
    --accent-2:#7ee0c1; /* soft mint */
    --text:#111827;
  }

  *{box-sizing:border-box}
  html,body{
    height:100%;margin:0;
    font-family:'Poppins',sans-serif;
    background:linear-gradient(180deg,var(--bg-1),var(--bg-2));
    color:var(--text);
    -webkit-font-smoothing:antialiased
  }

  /* Intro overlay */
  .intro-wrap{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;
    background:linear-gradient(180deg,rgba(255,255,255,0.96),rgba(255,255,255,0.9));
    z-index:9999;backdrop-filter: blur(6px);
  }
  .intro-card{
    width:92%;max-width:880px;padding:36px;border-radius:14px;background:var(--card);
    box-shadow: 0 10px 30px rgba(16,24,40,0.12);
    text-align:center; overflow:hidden;
  }
  .intro-line{font-weight:600;font-size:1.05rem;color:var(--muted);opacity:0;transform:translateY(10px)}
  .intro-title{font-size:1.6rem;font-weight:700;margin-bottom:12px;color:var(--text);opacity:0;transform:translateY(12px)}
  .intro-sub{margin-top:10px;color:var(--muted);font-size:0.98rem;opacity:0;transform:translateY(8px)}
  .enter-btn{
    margin-top:18px;padding:10px 20px;border-radius:999px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:white;font-weight:700;cursor:pointer;opacity:0;transform:translateY(10px);
    box-shadow:0 8px 20px rgba(100,120,255,0.16);
  }
  .fade-out{opacity:0 !important; visibility:hidden !important; transition:opacity .6s ease, visibility .6s}

  /* App */
  .app{display:flex;flex-direction:column;height:100vh}
  header.app-head{
    height:72px;display:flex;align-items:center;justify-content:space-between;padding:0 28px;
    background:transparent;border-bottom:1px solid rgba(16,24,40,0.06)
  }
  .brand{display:flex;align-items:center;gap:14px}
  .logo{
    width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#b8c6ff);
    display:flex;align-items:center;justify-content:center;color:white;font-weight:700;
    box-shadow:0 6px 16px rgba(108,140,255,0.12); font-size:0.95rem;
  }
  .brand h1{font-size:1.05rem;margin:0;font-weight:700;color:var(--text)}
  .meta{font-size:0.85rem;color:var(--muted)}

  .container{display:flex;justify-content:center;flex:1;padding:28px}
  .panel{
    width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.88),rgba(255,255,255,0.84));
    border-radius:14px;box-shadow:0 12px 40px rgba(16,24,40,0.08);
    display:flex;flex-direction:column;overflow:hidden;
  }

  .chat-body{
    display:flex;flex-direction:column;gap:18px;padding:28px;
    height:calc(100vh - 72px - 140px);overflow:auto;
    background:linear-gradient(180deg,rgba(255,255,255,0.2),rgba(255,255,255,0.12));
  }

  .welcome{align-self:center;padding:14px 20px;text-align:center;max-width:800px;animation:fadeInUp .7s ease both}
  .welcome h2{margin:0 0 8px 0;font-size:1.15rem}
  .welcome p{margin:0;color:var(--muted)}

  .msg{
    max-width:74%;padding:14px 18px;border-radius:14px;line-height:1.5;font-size:0.98rem;
    box-shadow:0 6px 18px rgba(16,24,40,0.06);animation:fadeInUp .45s ease both;
    backdrop-filter: blur(6px)
  }
  .msg.bot{align-self:flex-start;background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.5));border-left:4px solid var(--accent)}
  .msg.user{align-self:flex-end;background:linear-gradient(180deg,rgba(124,190,255,0.18),rgba(126,224,193,0.12));border-right:4px solid var(--accent-2);font-weight:600}

  .typing{display:flex;gap:8px;align-items:center;padding-left:8px;align-self:flex-start;color:var(--muted);font-style:italic}
  .dot{width:8px;height:8px;border-radius:50%;background:var(--accent);opacity:.25;animation:dot 1.2s infinite ease-in-out}
  .dot.d2{background:var(--accent-2);animation-delay:.12s}
  .dot.d3{background:var(--accent);animation-delay:.24s}

  .composer{border-top:1px solid rgba(16,24,40,0.06);padding:18px 22px;display:flex;gap:12px;align-items:center;background:transparent}
  .input{
    flex:1;background:rgba(255,255,255,0.9);border-radius:999px;padding:12px 18px;border:1px solid rgba(16,24,40,0.06);
    box-shadow:0 6px 18px rgba(16,24,40,0.04);resize:none;font-size:1rem;color:var(--text)
  }
  .btn{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;padding:10px 16px;border-radius:999px;color:white;font-weight:700;cursor:pointer;
    box-shadow:0 10px 30px rgba(108,140,255,0.12)
  }

  @keyframes fadeInUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
  @keyframes introTitle { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes dot{0%,80%,100%{opacity:.15;transform:translateY(0)}40%{opacity:1;transform:translateY(-6px)}}

  @media (max-width:880px){
    .panel{margin:0 12px}
    .chat-body{padding:18px;height:calc(100vh - 72px - 160px)}
    .msg{max-width:86%}
  }
</style>
</head>
<body>
  <!-- INTRO -->
  <div class="intro-wrap" id="intro">
    <div class="intro-card" aria-hidden="false">
      <div class="intro-title" id="introTitle">Imaba Studio</div>
      <div class="intro-line" id="line1">Halo! Saya sistem AI buatan siswa</div>
      <div class="intro-line" id="line2">SMK Informatika Amanah Bangsa</div>
      <div class="intro-line" id="line3">dengan teknologi <strong>Gemini 2.5</strong>.</div>
      <div class="intro-sub" id="sub">Menyapa, menjawab, dan membantu â€” mulai saja tanya apa pun.</div>
      <button class="enter-btn" id="enterBtn">Mulai Chat</button>
    </div>
  </div>

  <!-- APP -->
  <div class="app" id="app" aria-hidden="true">
    <header class="app-head">
      <div class="brand">
        <div class="logo">IM</div>
        <h1>Imaba Studio</h1>
      </div>
      <div class="meta">Sistem AI â€¢ Gemini 2.5</div>
    </header>

    <div class="container">
      <div class="panel" role="main" aria-label="Chat panel">
        <div class="chat-body" id="chatBody">
          <div class="welcome" id="welcomeCard">
            <h2>Selamat datang ðŸ‘‹</h2>
            <p>Halo! Saya sistem AI buatan siswa <strong>SMK Informatika Amanah Bangsa</strong> dengan teknologi <strong>Gemini 2.5</strong>. Tanyakan apa saja â€” saya akan bantu sebaik mungkin.</p>
          </div>
        </div>

        <form id="composer" class="composer" onsubmit="return false;">
          <textarea id="input" class="input" placeholder="Tanyakan sesuatu... " rows="1"></textarea>
          <button id="send" class="btn" type="button">Kirim</button>
        </form>
      </div>
    </div>
  </div>

  <!-- AUDIO -->
  <audio id="introAudio" preload="auto">
    <source src="ai.mp3" type="audio/mpeg">
  </audio>

<script>
  /* ====== CONFIG ====== */
  const SYNC_TEXT =
    "Halo! Saya sistem AI buatan siswa SMK Informatika Amanah Bangsa dengan teknologi Gemini 2.5. Tanyakan apa saja â€” saya akan bantu sebaik mungkin.";
  const SYNC_DURATION_MS = 10000; // 10 detik
  const GEMINI_API_KEY = 'AIzaSyBx8pzE-XQKKgJet2HU_EeZsqQ_CgpA10E'; // Ganti dengan API key Gemini Anda
  const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

  /* ====== INTRO SEQUENCE ====== */
  (function introSequence(){
    const intro = document.getElementById('intro');
    const title = document.getElementById('introTitle');
    const lines = [document.getElementById('line1'), document.getElementById('line2'), document.getElementById('line3')];
    const sub = document.getElementById('sub');
    const btn = document.getElementById('enterBtn');
    const app = document.getElementById('app');
    const audio = document.getElementById('introAudio');

    // reveal animations
    title.style.animation = 'introTitle .6s ease forwards';
    title.style.animationDelay = '0.2s';
    lines.forEach((el,i)=>{
      setTimeout(()=>{ el.style.opacity=1; el.style.transform='none'; el.style.transition='opacity .5s ease, transform .5s ease'; }, 500 + i*280);
    });
    setTimeout(()=>{ sub.style.opacity = 1; sub.style.transition = 'opacity .5s ease'; }, 1200);
    setTimeout(()=>{ btn.style.opacity = 1; btn.style.transform = 'none'; btn.style.transition = 'opacity .4s ease, transform .4s ease'; }, 1400);

    // Start experience on click (required by browser for audio)
    btn.addEventListener('click', async () => {
      // Play audio (best effort)
      try {
        audio.currentTime = 0;
        await audio.play();
      } catch(e) {
        console.log('Audio play blocked:', e);
      }

      // Fade out overlay + show app
      intro.classList.add('fade-out');
      setTimeout(()=> {
        intro.remove();
        app.removeAttribute('aria-hidden');
        // Start synced greeting in chat
        startSyncedGreeting();
        // Focus input
        setTimeout(()=> document.getElementById('input').focus(), 250);
      }, 620);
    });

    // Allow Enter to start (when not typing in textarea)
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && document.activeElement !== document.getElementById('input')){
        btn.click();
      }
    });
  })();

  /* ====== CHAT CORE ====== */
  const chatBody = document.getElementById('chatBody');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('send');

  function appendMessage(kind, text) {
    const el = document.createElement('div');
    el.className = 'msg ' + (kind === 'user' ? 'user' : 'bot');
    el.textContent = text;
    chatBody.appendChild(el);
    chatBody.scrollTop = chatBody.scrollHeight;
    return el;
  }

  function showTyping() {
    const wrap = document.createElement('div');
    wrap.className = 'typing';
    wrap.innerHTML = '<div class="dot"></div><div class="dot d2"></div><div class="dot d3"></div>';
    chatBody.appendChild(wrap);
    chatBody.scrollTop = chatBody.scrollHeight;
    return wrap;
  }

  async function getGeminiReply(message) {
    try {
      const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [{
            parts: [{
              text: message
            }]
          }]
        })
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      
      // Extract the response text from Gemini API
      if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts) {
        return data.candidates[0].content.parts[0].text;
      } else {
        throw new Error('Invalid response format from Gemini API');
      }
    } catch (error) {
      console.error('Error calling Gemini API:', error);
      return "Maaf, terjadi kesalahan saat memproses permintaan Anda. Silakan coba lagi nanti.";
    }
  }

  async function handleSend(){
    const text = input.value.trim();
    if(!text) return;
    appendMessage('user', text);
    input.value = '';
    input.style.height = 'auto';

    const typing = showTyping();
    try {
      const reply = await getGeminiReply(text);
      typing.remove();
      appendMessage('bot', reply);
    } catch (e) {
      typing.remove();
      appendMessage('bot', 'Maaf, terjadi kesalahan saat memproses jawaban.');
      console.error(e);
    }
  }

  input.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && !e.shiftKey){
      e.preventDefault();
      handleSend();
    }
  });
  sendBtn.addEventListener('click', handleSend);

  // Auto-resize textarea
  input.addEventListener('input', ()=> {
    input.style.height = 'auto';
    input.style.height = input.scrollHeight + 'px';
  });

  /* ====== SYNCED GREETING (audio + typing over 10s) ====== */
  function startSyncedGreeting(){
    const typing = showTyping();

    // Placeholder bubble to progressively fill text
    const bubble = document.createElement('div');
    bubble.className = 'msg bot';
    bubble.textContent = ''; // will be filled gradually
    chatBody.appendChild(bubble);

    const start = performance.now();
    const total = SYNC_DURATION_MS;
    const full = SYNC_TEXT;

    function step(now){
      const elapsed = now - start;
      const progress = Math.min(elapsed / total, 1);
      const charCount = Math.floor(full.length * progress);

      bubble.textContent = full.slice(0, charCount);
      chatBody.scrollTop = chatBody.scrollHeight;

      // keep typing dots while not finished
      if(progress < 1){
        if(!typing.isConnected) chatBody.appendChild(typing);
        requestAnimationFrame(step);
      }else{
        // done: remove typing, ensure full text visible
        typing.remove();
        bubble.textContent = full;
      }
    }
    requestAnimationFrame(step);
  }
</script>
</body>
</html>
